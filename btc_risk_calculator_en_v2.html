<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BTC Risk Score Calculator</title>
  <style>
    :root{
      --bg:#f7f7f8; --card:#ffffff; --border:#e5e7eb; --text:#111827; --muted:#6b7280;
      --green-bg:#e6f4ea; --green-text:#166534; --green-brd:#86efac;
      --yellow-bg:#fff7d6; --yellow-text:#92400e; --yellow-brd:#fde68a;
      --red-bg:#fde8e8; --red-text:#991b1b; --red-brd:#fca5a5;
      --indigo-bg:#eef2ff; --indigo-text:#3730a3; --indigo-brd:#c7d2fe;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;color:var(--text);}
    .container{max-width:1100px;margin:40px auto;padding:0 16px}

    h1{font-size:28px;margin:0 0 6px}
    p.lead{color:var(--muted);margin:0 0 24px}

    .grid{display:grid;gap:16px}
    @media (min-width: 900px){
      .grid.inputs{grid-template-columns: repeat(5, minmax(0,1fr));}
      .grid.cards{grid-template-columns: repeat(3, minmax(0,1fr));}
      .grid.result{grid-template-columns: 2fr 1fr;align-items:start}
    }

    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .card h2{font-size:18px;margin:0 0 4px}
    .card small{color:var(--muted)}

    label.field{display:block}
    .label{font-size:13px;font-weight:600;color:#374151;margin:0 0 6px}
    input[type="number"], select{
      width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;font-size:14px;outline:none;
    }
    input[type="number"]:focus, select:focus{border-color:#9ca3af;box-shadow:0 0 0 3px rgba(156,163,175,.25)}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}

    .row-between{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--border);background:#fff;padding:8px 12px;border-radius:12px;font-size:14px;cursor:pointer}
    .btn:hover{background:#f3f4f6}

    .badge{display:inline-flex;align-items:center;border-radius:12px;border:1px solid;padding:6px 10px;font-size:13px;font-weight:600}
    .badge.green{background:var(--green-bg);color:var(--green-text);border-color:var(--green-brd)}
    .badge.yellow{background:var(--yellow-bg);color:var(--yellow-text);border-color:var(--yellow-brd)}
    .badge.red{background:var(--red-bg);color:var(--red-text);border-color:var(--red-brd)}
    .badge.indigo{background:var(--indigo-bg);color:var(--indigo-text);border-color:var(--indigo-brd)}

    table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    thead{background:#f9fafb}
    th, td{padding:10px 12px;text-align:left;font-size:14px}
    tbody tr:nth-child(even){background:#fafafa}
    tfoot td{font-weight:700}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:90%}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}

    .result-score{font-size:34px;font-weight:700}
    .muted{color:var(--muted)}
    .warn{color:#b45309;font-size:13px;margin-top:6px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>BTC Risk Score Calculator</h1>
      <p class="lead">Compute the risk score and group (Low / Intermediate / High) from patient data.</p>
    </header>

    <section class="grid inputs">
      <label class="field">
        <div class="label">Neutrophils (×10^9/L)</div>
        <input id="neut" type="number" step="0.01" min="0" placeholder="e.g., 4.6" />
      </label>
      <label class="field">
        <div class="label">ECOG PS</div>
        <select id="ecog">
          <option value="">— Select —</option>
          <option value="0">0 (ECOG = 0)</option>
          <option value="1">1 (ECOG &gt; 0)</option>
        </select>
      </label>
      <label class="field">
        <div class="label">Stage</div>
        <select id="stage">
          <option value="">— Select —</option>
          <option value="0">0 (Locally advanced)</option>
          <option value="1">1 (Metastatic)</option>
        </select>
      </label>
      <label class="field">
        <div class="label">CA19.9 (U/mL)</div>
        <input id="ca199" type="number" step="1" min="0" placeholder="e.g., 900" />
        <div class="hint">Auto-encoding: 0 if ≤1051; 1 if &gt;1051</div>
      </label>
      <label class="field">
        <div class="label">CEA (ng/mL)</div>
        <input id="cea" type="number" step="0.01" min="0" placeholder="e.g., 2.7" />
        <div class="hint">Auto-encoding: 0 if ≤3.80; 1 if &gt;3.80</div>
      </label>
    </section>

    <section class="grid cards" style="margin-top:16px">
      <div class="card">
        <h2>CA19.9 (encoded)</h2>
        <div id="ca199-coded" class="badge indigo">—</div>
      </div>
      <div class="card">
        <h2>CEA (encoded)</h2>
        <div id="cea-coded" class="badge indigo">—</div>
      </div>
      <div class="card">
        <h2>ECOG / Stage</h2>
        <div class="row-between">
          <span id="ecog-show" class="badge">ECOG: —</span>
          <span id="stage-show" class="badge">Stage: —</span>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <div class="row-between">
        <div>
          <h2>Result</h2>
          <small>The score appears when all fields are filled.</small>
          <div id="missing" class="warn" aria-live="polite"></div>
        </div>
        <div>
          <button class="btn" id="reset">Reset</button>
        </div>
      </div>

      <div class="grid result" style="margin-top:16px">
        <div>
          <div style="overflow:hidden;border:1px solid var(--border);border-radius:12px">
            <table>
              <thead>
                <tr>
                  <th>Component</th>
                  <th class="mono" style="text-align:right">Value</th>
                  <th class="mono" style="text-align:right">Product</th>
                </tr>
              </thead>
              <tbody id="breakdown-body">
                <!-- dynamic rows -->
              </tbody>
              <tfoot>
                <tr>
                  <td>Total</td>
                  <td></td>
                  <td id="subtotal" class="mono" style="text-align:right">—</td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
        <div>
          <div class="muted">Risk score</div>
          <div id="score" class="result-score">—</div>
          <div class="muted" style="margin-top:8px">Group</div>
          <div id="group" class="badge" style="margin-top:4px">—</div>
        </div>
      </div>
    </section>

    <section style="margin-top:20px" class="card">
      <h2>Details</h2>
      <ul style="margin:6px 0 0 18px;color:var(--muted);font-size:14px;line-height:1.5">
        <li>Formula: <code>0.1757×Neutrophils + 0.5055×ECOG + 1.4037×Stage + 0.1108×CA19.9_encoded + 0.2126×CEA_encoded</code></li>
        <li>Groups: <strong>Low</strong> (≤ 2.14), <strong>Intermediate</strong> (2.15–2.89), <strong>High</strong> (&gt; 2.89)</li>
      </ul>
    </section>
  </div>

  <script>
    const el = (id)=>document.getElementById(id);
    const inputs = { neut: el('neut'), ecog: el('ecog'), stage: el('stage'), ca199: el('ca199'), cea: el('cea') };

    function parseNum(v){
      if(v==="" || v===null || v===undefined) return null;
      const n = Number(v);
      return Number.isFinite(n) ? n : null;
    }

    function fmt(v){ return v==null ? '—' : Number(v).toFixed(2); }

    function update(){
      const neut = parseNum(inputs.neut.value);
      const ecog = inputs.ecog.value==='' ? null : Number(inputs.ecog.value);
      const stage = inputs.stage.value==='' ? null : Number(inputs.stage.value);
      const ca199 = parseNum(inputs.ca199.value);
      const cea = parseNum(inputs.cea.value);

      const ca199_c = ca199==null ? null : (ca199 > 1051 ? 1 : 0);
      const cea_c = cea==null ? null : (cea > 3.8 ? 1 : 0);

      // Update encoded badges
      const caEl = el('ca199-coded');
      caEl.className = (ca199_c==null ? 'badge indigo' : (ca199_c===1 ? 'badge indigo' : 'badge'));
      caEl.textContent = (ca199_c==null ? '—' : (ca199_c===1 ? '1 (>1051)' : '0 (≤1051)'));

      const ceaEl = el('cea-coded');
      ceaEl.className = (cea_c==null ? 'badge indigo' : (cea_c===1 ? 'badge indigo' : 'badge'));
      ceaEl.textContent = (cea_c==null ? '—' : (cea_c===1 ? '1 (>3.80)' : '0 (≤3.80)'));

      // ECOG / Stage chips
      el('ecog-show').textContent = `ECOG: ${ecog==null ? '—' : ecog}`;
      el('stage-show').textContent = `Stage: ${stage==null ? '—' : stage}`;

      const needed = [];
      if(neut==null) needed.push('Neutrophils');
      if(ecog==null) needed.push('ECOG PS');
      if(stage==null) needed.push('Stage');
      if(ca199_c==null) needed.push('CA19.9');
      if(cea_c==null) needed.push('CEA');
      el('missing').textContent = needed.length ? `Missing: ${needed.join(', ')}` : '';

      const rows = [
        {label:'0.1757 × Neutrophils', v: neut, w:0.1757},
        {label:'0.5055 × ECOG', v: ecog, w:0.5055},
        {label:'1.4037 × Stage', v: stage, w:1.4037},
        {label:'0.1108 × CA19.9_enc.', v: ca199_c, w:0.1108},
        {label:'0.2126 × CEA_enc.', v: cea_c, w:0.2126},
      ];
      const tbody = el('breakdown-body');
      tbody.innerHTML = rows.map(r=>{
        const prod = r.v==null ? null : r.v * r.w;
        const vStr = r.v==null ? '—' : (typeof r.v==='number' ? r.v.toFixed(2) : String(r.v));
        return `<tr><td>${r.label}</td><td class="mono" style="text-align:right">${vStr}</td><td class="mono" style="text-align:right">${fmt(prod)}</td></tr>`;
      }).join('');

      if(needed.length===0){
        const score = 0.1757*neut + 0.5055*ecog + 1.4037*stage + 0.1108*ca199_c + 0.2126*cea_c;
        el('score').textContent = score.toFixed(2);
        el('subtotal').textContent = score.toFixed(2);
        const g = group(score);
        const grp = el('group');
        grp.textContent = g.label;
        grp.className = `badge ${g.cls}`;
      } else {
        el('score').textContent = '—';
        el('subtotal').textContent = '—';
        const grp = el('group');
        grp.textContent = '—';
        grp.className = 'badge';
      }
    }

    function group(score){
      if(score <= 2.14) return {label:'Low', cls:'green'};
      if(score <= 2.89) return {label:'Intermediate', cls:'yellow'};
      return {label:'High', cls:'red'};
    }

    Object.values(inputs).forEach(i=>i.addEventListener('input', update));
    el('reset').addEventListener('click', ()=>{
      Object.values(inputs).forEach(i=> i.value = '');
      update();
    });

    // init
    update();
  </script>
</body>
</html>
